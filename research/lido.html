<!DOCTYPE html><!--  This site was created in Webflow. https://www.webflow.com  -->
<!--  Last Published: Mon Jan 15 2024 09:41:59 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="6599423dbb9e8df41d14040a" data-wf-site="6594359b0f0aa758b21d5c90">
<head>
  <meta charset="utf-8">
  <title>Lido</title>
  <meta content="Lido" property="og:title">
  <meta content="Lido" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/asxn_res_webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Ubuntu:300,300italic,400,400italic,500,500italic,700,700italic"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav">
    <div class="container w-container">
      <nav role="navigation" class="nav-menu w-nav-menu">
        <a href="index.html" class="w-nav-link">Research</a>
      </nav>
      <div class="w-nav-button">
        <div class="w-icon-nav-menu"></div>
      </div>
    </div>
  </div>
  <section>
    <div class="w-layout-blockcontainer w-container">
      <h1 class="heading-2">Lido v2: The Liquid Staking Router &amp; DVT </h1>
      <div>Written by Uponlysometimes, 0xfromm &amp; 0xMunehisa<br><br>5th of October 2023</div>
    </div>
  </section>
  <section class="section-3">
    <div class="w-layout-blockcontainer w-container">
      <div class="text-block"><strong class="bold-text-2">Overview</strong><br>Since the launch of Lido protocol in December 2020, the protocol has seen exceptional growth and cemented itself as the leading liquid staking protocol, amassing over 8M ETH staked, equivalent to 32% market share. <br><br>In recent times, Lido has made significant strides with the launch of V2, introducing new functionalities such as withdrawals and the innovative Staking Router concept. Whilst V1 was grounded in a Curated Operator set, the Lido V2 iteration transforms the platform into a modular stake allocation marketplace, backed by the DAO’s governance. <br><br>At its very core, the Staking Router consolidates Lido’s vision, unifying stakers, developers and node operators to foster a decentralised Ethereum ecosystem. In addition to simplifying stake management, Lido V2 has adopted Distributed Validator Technology (DVT) to distribute validators across multiple machines, enhancing resilience and reducing single points of failure.This is done by fragmenting the validator&#x27;s private key and distributing it across a network of computers; this setup complicates attacks and provides fault tolerance, ensuring the network remains robust even if some nodes go offline. The evolution highlights Lido’s commitment to achieving a robust Ethereum validator set without compromising on quality, security and decentralisation.</div><img src="images/l1.webp" loading="lazy" sizes="(max-width: 767px) 96vw, (max-width: 991px) 728px, 940px" srcset="images/l1-p-500.webp 500w, images/l1-p-800.webp 800w, images/l1-p-1080.webp 1080w, images/l1.webp 1456w" alt="" class="image">
      <div class="text-block-7">Diagram from <a href="https://blog.lido.fi/introducing-lido-v2/">  Lido</a>
      </div>
      <div><strong>Lido v1</strong><br>Before delving into V2 we will take a closer look at the functionalities of v1<br><br><strong>Ethereum’s Path<br><br>‍</strong>When a user deposits ETH into Lido&#x27;s contract, they receive a proportional portion of Lido&#x27;s total stETH pool. The stETH pool&#x27;s size can increase from consensus and execution layer rewards or decrease due to slashing penalties. Consequently, the value of a user&#x27;s stETH share can either rise or fall. Before staking, the deposited Ether is stored in the Lido contract&#x27;s balance, commonly referred to as &quot;buffered&quot; or in the &quot;deposit buffer&quot;, it awaits transfer to the deposit contract.<br><br><strong><em>Providing ETH from the user’s point of view;</em></strong></div><img src="images/l2.webp" loading="lazy" sizes="100vw" srcset="images/l2-p-500.webp 500w, images/l2-p-800.webp 800w, images/l2-p-1080.webp 1080w, images/l2.webp 1456w" alt="" class="image">
      <div><strong>Balance Synchronisation and Oracles<br><br>‍</strong>One of Lido&#x27;s key functions is to keep the total validator balances aligned with the stETH supply, this way 1 stETH = 1 ETH. To do this, it uses oracles that update the Lido contract to reflect changes in validator balances. Oracles are used due to the fact that the consensus and execution layers are separate. These updates usually occur daily.<br><br>‍<strong>Reward Distribution<br><br>‍</strong>Users get 90% of all rewards earned by validators. The remaining 10% is a protocol fee, half of which goes to the treasury and the other 5% to node operators.</div>
      <div class="w-layout-blockcontainer container-7 w-container"><img src="images/l3.webp" loading="lazy" sizes="100vw" srcset="images/l3-p-500.webp 500w, images/l3-p-800.webp 800w, images/l3.webp 836w" alt="" class="image"></div>
      <div><strong>Key management and Validator Activation</strong><br><br>After approval, the node operator is included in NodeOperatorsRegistry and can add their signing keys to this contract. These keys, once sent to the DepositContract, place the corresponding validators in an activation queue. After activation, these validators join the consensus process.<br><br><strong>Staking Limits</strong><br><br>While there isn’t a cap on the number of keys a node operator can submit, Lido sets staking limits for each one. This means each operator can only have a certain number of approved keys and is restricted to initiating a limited number of validators. These limits can be changed through Aragon Voting or EasyTrack mechanisms.<br><br><strong>Evolution of Deposit Security Overview</strong><br><br>Deposits to the DepositContract require withdrawal credentials (WC) so that only authorised parties can withdraw funds in the future. All Lido deposits use Lido-approved WC to make sure only Lido can access user funds.<br><br>During Oct 2021, a vulnerability was discovered that allowed a bad acting Node Operator to intercept user funds on deposits to the Beacon Chain. This vulnerability was achieved by the malicious Node Operator front running the Lido.depositBufferedEther function by directly depositing at least 1 ETH to the deposit contract using the same validator key but different withdrawal credentials to Lido subsequently allowing them to gain control of the  32 ETH from Lido. Thereafter the LIP-5 was raised to fix this deposit front-running vulnerability in which we saw the advent of the Guardian Committee. <br><br><strong>‍<em>Guardian Committee&#x27;s Role:</em></strong><em><br><br>‍</em>Before making a batch deposit, a guardian committee checks for any malicious pre-deposits. They sign a message containing:<br><br>- The Merkle root of all deposits, depositRoot from DepositContract<br>- A nonce of key operations; keyOpsIndex from NodeOperatorsRegistry<br>- Block number<br>- Block hash<br><br>The depositor bot then proceeds to submit these messages to DepsoitSecurityContract. Here, the guardian signatures are verified and confirm the block with the specified number contains the specified hash. </div><img src="images/l4.webp" loading="lazy" sizes="100vw" srcset="images/l4-p-500.webp 500w, images/l4-p-800.webp 800w, images/l4-p-1080.webp 1080w, images/l4.webp 1456w" alt="" class="image">
      <div><strong>Lido V2 Overview<br><br>‍</strong>Lido V2 introduces enhanced features, including a user withdrawal option. Building on V1&#x27;s Curated Node Operator Registry, it now incorporates a StakingRouter, transforming Lido into a stake allocation marketplace with diverse staking modules. <br><br>‍<strong>Withdrawal Option:</strong> Lido V2 introduced the capability for users to withdraw.<br><br>‍<strong>StakingRouter Introduction: </strong>The previous Curated Node Operator Registry in V1 will now be encapsulated into a modular system via the StakingRouter.<br><br>‍<strong>Modular Transformation</strong>: Lido now functions more akin to a stake allocation marketplace, granting users a variety of staking choices or modules.<br><br>‍<strong>Module Management: </strong>The DAO oversees the stake allocations to newer modules as they are incorporated.<br><br>‍<strong>Default delegation Layer on top of Ethereum: </strong>Lido v2 provides a marketplace for delegation across several profiles of validators instead of just pro validators. <br><br>‍<strong><em>Providing ETH from the user’s point of view;</em></strong></div>
      <div class="w-layout-blockcontainer container-3 w-container"><img src="images/l5.webp" loading="lazy" sizes="100vw" srcset="images/l5-p-500.webp 500w, images/l5-p-800.webp 800w, images/l5-p-1080.webp 1080w, images/l5.webp 1456w" alt="" class="image"></div>
      <div><strong>Staking Router Introduction:<br><br>‍</strong>The Staking Router is a smart contract that serves as the central manager for different groups of validators. It organises these groups into separate contracts called modules. Each module is responsible for its own set of tasks like managing node operators, storing their digital keys, and allocating stakes and rewards among them.<br><br>Although the internal workings of each module may vary widely due to different technologies, they all need to follow a common set of rules, known as an &quot;interface,&quot; to interact with the Staking Router. This means that every module must have a standardised way to provide certain types of information, like the digital keys of its validators, so that the Staking Router can coordinate everything smoothly.<br><br>When the development team were creating specifications for Staking Router, they considered different kinds of validator groups that could work with it. Amongst these are the following: <br><br>1. <strong><em>Curated:</em> </strong>These are node operators chosen and managed by a DAO. This is similar to the existing NodeOperatorsRegistry system.<br><br>2. <strong><em>Community:</em></strong> These are node operators that anyone can join if they put down a financial bond. The bond amount can be reduced if the operator has a good reputation.<br><br>3. <strong><em>DVT:</em> </strong>These are special validators that use DVT technology. They might also require a bond. Examples include Obol&#x27;s Distributed Validator Clusters or SSV nodes.Blockchains disperse responsibility to validators across the globe, DVT provides the opportunity to logically break 1 validator into multiple parties to enhance resilience and minimise single points of failure.<br><br>This is achieved by fragmenting the private key securing a validator and distributing it across a network of computers, known as a &quot;cluster&quot;. This setup not only complicates the task for attackers trying to access the complete key, as it&#x27;s not fully stored on any single machine, but also allows for a degree of fault tolerance. If some nodes in the cluster go offline, the remaining nodes can still carry out the necessary signing, thereby bolstering the overall robustness of the validator network.</div>
      <div class="w-layout-blockcontainer container-4 w-container"><img src="images/l6.webp" loading="lazy" sizes="100vw" srcset="images/l6-p-500.webp 500w, images/l6-p-800.webp 800w, images/l6.webp 834w" alt="" class="image"></div>
      <div class="text-block-8"><em>Diagram from </em>
        <a href="https://ethereum.org/en/staking/dvt/"><em> ethereum.org</em></a>
      </div>
      <div><strong>Key Features of DVT:<br><br></strong>-<strong> </strong><strong>Fault Tolerance</strong>: Ensures the validator remains online even if one machine goes offline.<br><br>- <strong>Enhanced Uptime</strong>: With distributed validators, there&#x27;s the potential to achieve up to 99.9% uptime.<br><br>- <strong>Beneficial for Solo Stakers</strong>: Solo stakers or small-scale operators can benefit as their nodes remain online, even if individual nodes go offline.<br><br>- <strong>Geographical diversity</strong>: Geographic diversity within the validator, comprising clients from different locations, enhances its resilience to various forms of stress.<br><br>- <strong>Client Diversity</strong>: Each validator using DVT could consist of various client implementations to prevent specific bugs from impacting the validator&#x27;s overall performance. If numerous validators adopt DVT, the network would feature validators composed of diverse clients, which are more resilient, varied, and distributed across different regions of the world.<br><br>- <strong><em>Offchain or L2</em></strong><em>:</em> This is an improved version of the Curated group. It saves money on transaction fees by storing validator keys somewhere other than the main blockchain, like a separate layer or an off-chain database.<br><br>Each of these groups has different rules and features, but they&#x27;re all designed to work with the Staking Router.<br><br>The Staking Router is a manager for deposits and future withdrawals across multiple modules, aligned with the objectives set by Lido DAO. Initially, Lido DAO specifies the maximum percentage of active validators each module can have. If a module performs well, its validator capacity can be increased. The overarching goal is to achieve capital efficiency while maintaining both safety and diversity in blockchain validation.<br><br><br>‍<strong>Analogical Explanation (Using Financial Statements):<br>‍<br><br>Pre-Staking Router: <br>‍</strong>Lido primarily possessed assets in the form of Ethereum staked within a curated validator group. On the liabilities side, there was stETH in a validator set eligible for withdrawal and a surplus. (stETH is a future obligation that the DAO must give back to the user).<br><br>‍<strong>Post-Staking Router: <br>‍</strong>With the advent of the Staking Router, Lido V2 presents a varied asset portfolio featuring assorted validator sets.</div><img src="images/l7.webp" loading="lazy" sizes="100vw" srcset="images/l7-p-500.webp 500w, images/l7-p-800.webp 800w, images/l7-p-1080.webp 1080w, images/l7.webp 1280w" alt="" class="image">
      <div class="text-block-9"><em>Diagram from </em>
        <a href="https://www.adcv.xyz/steth-is-the-decentralized-reserve-currency/"><em> adcv</em></a>
      </div>
    </div>
    <div class="w-layout-blockcontainer w-container">
      <div><strong>Stake Allocation Algorithm</strong><br><br>A new feature is the introduction of a <em>stake allocation algorithm</em>, which determines how to distribute incoming Ether among various modules.This is the main difference in the deposit process. It optimises the use of deposited capital. The Lido contract continues to serve as a deposit buffer, but some of the ether is now transferred to the Staking Router during the deposit process. The Staking Router calculates the ether amount to be allocated to each module and executes the deposits. This is referred to as the <em>stake allocation.<br><br>‍</em>Managing Relative Module Sizing via the Staking Router <br><br>To control the proportional sizes of individual modules, the DAO sets a target share for each module that joins, calculated as the percentage of its active validators relative to the overall number across all modules. Concurrently, this target serves as the module&#x27;s quota, tilting stake allocation towards modules that have fewer deposits. Below we will go through an example of how this operates:<br><br>‍<em>Example: <br><br></em><strong><em>Modules at the beginning of an allocation round</em></strong><strong></strong></div>
    </div>
    <div class="w-layout-blockcontainer w-container"><img src="images/l8.webp" loading="lazy" sizes="100vw" srcset="images/l8-p-500.webp 500w, images/l8-p-800.webp 800w, images/l8-p-1080.webp 1080w, images/l8.webp 1456w" alt="" class="image"></div>
    <div class="w-layout-blockcontainer w-container"><img src="images/l9.webp" loading="lazy" sizes="100vw" srcset="images/l9-p-500.webp 500w, images/l9-p-800.webp 800w, images/l9-p-1080.webp 1080w, images/l9.webp 1456w" alt="" class="image"></div>
    <div class="w-layout-blockcontainer w-container">
      <div>The above visualisations capture the dynamics of stake allocation in Lido&#x27;s upgraded architecture. Managed by the Staking Router, the deposit procedure aims to align the current share of each module&#x27;s active validators with a DAO-imposed target share. <br><br>The first chart, <em>&quot;Target vs Current Shares by Module,&quot;</em> reveals the initial state of this mechanism. It shows that while the &quot;Community&quot; and &quot;DVT&quot; modules were below their target shares, the &quot;Curated&quot; module was already above its target. <br><br>The second chart, <em>&quot;Active Validators and Ready-to-Deposit Keys by Module,&quot; </em>further highlights each module&#x27;s readiness to onboard new validators. Notably, the &quot;Curated&quot; module has a significant number of validators ready for deposit, which as shown below will influence the next allocation round. These charts offer a snapshot of the stake allocation process, showing how the DAO&#x27;s target shares guide the distribution of ether among the modules.<br><br><strong>Target Share: </strong>This is a predetermined percentage set by the DAO that dictates how many active validators a particular module should aim to have relative to the total number of active validators across all modules. Essentially, it&#x27;s a quota or goal for each module to reach and is used to guide the allocation of new validators. The target share is a way to control the proportionate size of each module within the overall system.<br><br><strong>Ready-to-Deposit Keys:</strong> These are keys that are ready to be activated as validators but have not yet been allocated Ether. They are essentially &quot;waiting in line&quot; to become active validators. These keys can quickly become active validators during the next allocation round, provided enough ether is available in the deposit buffer. <br><br>To further understand the entire process, we will go through a specific example below detailing the state of modules after an allocation round.<br><br><strong>‍<em>Modules after the allocation round<br><br>‍</em></strong>Assume there&#x27;s 32,000 Ether available for adding 1000 new validators. The algorithm begins by allocating Ether to the smallest module first, stopping when one of the following conditions is met:<br><br>- The module&#x27;s size equals the next larger module<br>- All available validators in the module have been funded<br>- The module&#x27;s predefined quota is fulfilled (target share)<br><br>If multiple modules are of the same size, have validators ready, and haven&#x27;t yet met their predefined quotas, the remaining ether is evenly distributed among them until either they reach their capacity or the ether runs out.<em><br></em><br><strong>Step 1: Calculate Flat Caps<br>‍</strong><br>The first step is to calculate the maximum number of validators for each module, known as the &quot;flat caps,&quot; based on their target shares.<br><br><em>Flat Cap of a Module =</em> Target Share of the Module × Total Active Validators<br><br>Community: Flat Cap = 0.1 x 11000 = 1100 validators<br>DVT: Flat Cap = 0.2 x 11000 = 2200 validators<br>Curated: Flat Cap = 0.7 x 11000 = 7700 <br><br><strong>Validators Step 2: Allocation to Modules</strong><br><br>The algorithm then starts by allocating Ether to the smallest module first. It stops when either the module reaches its flat cap, all ready validators are covered, or the target share is reached.<br><br><strong>‍<em>Community Module</em></strong><em><br><br>‍</em>﻿﻿- Flat Cap: 1100 validators﻿﻿<br>- Already Active Validators: 700﻿﻿<br>- Ready Validators: 300﻿﻿Ether<br>- Required: 300 × Ether per Validator = 9600<br><br>Initial State: At the start of the allocation process, the Community module had 700 active validators and 300 ready-to-deposit keys.<br><br>Ether Requirement: To convert these 300 ready-to-deposit keys into active validators, the Community module required 300×32 = 9,600 ether.<br><br>Allocation Outcome: The algorithm allocated the required 9,600 ether to the Community module, allowing all 300 ready-to-deposit keys to become active validators.Final State: With this allocation, the Community module ended up with a total of 1,000 active validators, which is within its flat cap of 1,100 validators. <br><br>This means the Community module successfully onboarded all its ready validators without exceeding its target share.<br><br><strong>‍<em>DVT Module<br><br></em></strong><em>- </em>﻿﻿Flat Cap: 2200 validators<br>- ﻿﻿Already Active Validators: 1800﻿﻿<br>- Ready Validators: 500﻿﻿Ether <br>- Required: 400 × Ether per Validator = 12800<br><br>In this instance we have a flat cap of 2200 validators with 1800 already active and 500 ready. 2200-1800 = 400 ready to deposit keys that can be onboarded as active validators without exceeding the Flat Cap. Therefore, 100 ready validators will be left for the next allocation. <br><br><strong>‍<em>Curated Module<br><br></em></strong><em>- </em>﻿﻿Flat Cap: 7700 validators﻿﻿<br>- Already Active Validators: 7500<br>- ﻿﻿Ready Validators: 2000﻿﻿Ether <br>- Required: 400 × Ether per Validator = 9600<br><br>In this final instance we have a flat cap of 7700 validators with 7500 already active and 2000 ready.7700-7500 = 200 ready to deposit keys that can be onboarded as active validators without exceeding the Flat Cap. Therefore, 1800 ready validators will be left for future allocations<br><br><strong>Step 3: Spill Over<br><br>‍</strong><em>Spill Over =</em> Initial Deposit Buffer - Total Allocated Ether<br><br>For example, the spill over would be 32000 - (9600 + 12800 + 9600) = 0<br><br>There is no spill over into the next round<br><br><br><strong>Modules Post Allocation Round:</strong></div>
    </div>
    <div class="w-layout-blockcontainer w-container"><img src="images/l11.webp" loading="lazy" sizes="100vw" srcset="images/l11-p-500.webp 500w, images/l11-p-800.webp 800w, images/l11-p-1080.webp 1080w, images/l11.webp 1456w" alt="" class="image"><img src="images/l12.webp" loading="lazy" sizes="100vw" srcset="images/l12-p-500.webp 500w, images/l12-p-800.webp 800w, images/l12-p-1080.webp 1080w, images/l12.webp 1456w" alt="" class="image"></div>
    <div class="w-layout-blockcontainer w-container">
      <div>The first chart, <em>&quot;Target vs Current Shares by Module (After Allocation),&quot;</em> showcases the algorithm&#x27;s success in aligning each module&#x27;s share of active validators with its DAO-imposed target. This alignment is a cornerstone in maximising capital efficiency and ensuring a balanced flow of ether across modules.<br><br>The second chart, <em>&quot;Active Validators and Ready-to-Deposit Keys by Module (After Allocation),&quot;</em> provides insights into each module&#x27;s capacity post-allocation. Here, we observe that the &quot;Community&quot; and &quot;DVT&quot; modules have nearly reached their flat caps, while the &quot;Curated&quot; module retains room for growth. <br><br>These visualisations collectively validate the algorithm&#x27;s ability to adapt in real-time, ensuring minimal idle ether and facilitating a move toward target shares.<br>‍<br>‍<strong>Curated module <br><br>‍</strong>The existing &quot;NodeOperatorsRegistry&quot; becomes the &quot;Curated module.&quot; This means it needs to fit into a new format, called the &quot;module interface.&quot; However, the basic design of this registry won&#x27;t change.<br><br>‍<strong>Fee Distribution<br><br>‍</strong>Rewards are distributed evenly across all modules based on the number of active validators and fee settings. Lido DAO has the flexibility to set different treasury fees for each module, which can enable some new and innovative strategies for Lido to gain stake.<br><br>Each module has its own way of setting fees, which consist of two parts:  <br><br>1. Fee for the module <br>2. Separate fee for the treasury.<br><br>As an illustration, the module might charge a 5% fee that is divided among the node operators in that module, and another 5% fee that goes directly to the treasury.<br><br>The system uses a high-precision factor (multiplier of 100 × 10^8) when calculating fees. This is done to ensure that the fees for smaller modules aren&#x27;t rounded down.<br><br>The system does not look at individual validator performance for distributing fees. Instead, it divides the fees among modules based on the number of active validators and the fee rate set by each module. This also has the effect of making stETH fully fungible, despite having the ETH backing deposited in different modules.<br><br>‍<br><strong><em>Example:  A Module with 75% of all active validators and a 5% fee;</em></strong></div>
    </div>
    <div class="w-layout-blockcontainer w-container"><img src="images/l13.webp" loading="lazy" sizes="100vw" srcset="images/l13-p-500.webp 500w, images/l13-p-800.webp 800w, images/l13-p-1080.webp 1080w, images/l13.webp 1456w" alt="" class="image"></div>
    <div class="w-layout-blockcontainer w-container">
      <div class="text-block-3">Provided the combined module and treasury fees are below 10%, the total fee taken by the protocol will not exceed 10%, irrespective of the number of modules.<br><br>There&#x27;s a special scenario where a module might be paused due to some emergency, even though its validators are still active. In this case, the module&#x27;s fees are sent to the treasury. <br><br>Once the module is operational again, these fees are returned to it from the treasury.<br><br>Below details a more granular view of the fee distribution function and includes a flow chart of the process.<br><br><br>‍<strong>The distribution function does the following:<br><br></strong>1.<strong> </strong><em>Initial Setup:</em> It loads data about the current staking modules and counts them.<br><br>2. <em>Empty Case:</em> If there are no staking modules or no one is actively validating transactions, the function simply returns an empty response<br><br>3. <em>Initialize Variables:</em> If there are active modules and validators, it sets up arrays to keep track of module IDs, who gets rewards, and how much those rewards are. It also sets a constant to measure fee precision called FEE_PRECISION_POINTS.<br><br>4. <em>Loop through Modules</em>: For each active staking module, the function does several things:<br><br>            - Saves its ID and the address of who gets the rewards.<br>            - Figures out what percentage of total active validators are in this module.<br>            - Calculates the module&#x27;s fee based on its share of active validators. If the module is running, this fee is stored.<br>            - Adds the module&#x27;s fee plus a treasury fee to a running total.<br><br><br>5. Check Total Fee: After going through all modules, it checks that the total fee isn&#x27;t more than 100%.<br><br>6. Clean Up: If some modules had zero active validators, their data is removed from the arrays.<br><br>Return Values: Finally, it returns data structures of who gets rewards; module IDs, the fees, the total fee, and the fee precision constant.<br><br>It gives a snapshot of how rewards are divided among participants.</div><img src="images/l14.webp" loading="lazy" sizes="100vw" srcset="images/l14-p-500.webp 500w, images/l14-p-800.webp 800w, images/l14-p-1080.webp 1080w, images/l14.webp 1456w" alt="" class="image">
    </div>
    <div class="w-layout-blockcontainer w-container">
      <div><strong>Future Modules Direction<br>‍<br></strong>The team has focused on immediate design decisions until now. In the next version of Staking Router, they plan to prioritise three key features: <br><br><strong>‍<em>1. Support for bonds; </em></strong><em><br><br>‍</em>Modules like Community and DVT need operators to provide bonds as collateral, partly funded by Lido&#x27;s pool. Until a complete bond system is ready, these bonds can be turned into stETH. This interim solution has risks during mass-slashing events but can be managed off-chain through an insurance fund. Two temporary options exist for handling stETH-based bonds: either distribute slashing penalties across the protocol or have an insurance fund cover them. Plans are in progress to create a true bond system that adjusts rewards and penalties based on individual performance.<br><br><strong>‍<em>2. Integration of withdrawals into the stake-balancing algorithm;</em></strong><em><br><br>‍</em>In addition to the balancing algorithms discussed earlier, the Staking Router can use a strategy to remove active validators and align modules with the DAO&#x27;s target shares. This will aid each module in achieving its target share of stake <br><br><strong>3. Compatibility with L2 and off-chain modules.</strong> <br><br>Despite anticipated interoperability challenges the Staking Router will accommodate L2 modules. Minimal interface needs will allow ease of integration for these modules. As a result of the design process the only required information for each module consists of: total, active, stopped and exited keys. It is also expected that there will be future feature requests from contributors and stakeholders.<br><br><br><strong>Conclusion<br><br></strong>Lido V2 represents a significant upgrade, incorporating a variety of features aimed at enhancing user experience, capital efficiency, and security. The introduction of the StakingRouter transforms Lido into a modular stake allocation marketplace, allowing for more diversified staking options. This is complemented by a new stake allocation algorithm designed to optimise the distribution of incoming deposits across different modules. DVT technology and new fee distribution mechanisms add layers of resilience and financial incentive to the system. With future updates focused on bond support, withdrawal integrations, and Layer 2 compatibility, Lido is well-positioned to continue positively shaping Ethereum staking by emphasising decentralisation, performance, and broader participation.<br><br><br><br><strong>References &amp; Further Reading:<br><br>‍</strong>
        <a href="https://hackmd.io/f1wvHzpjTIq41-GCrdaMjw"><strong>ADR: Staking Router, Lido<br><br>‍</strong></a>
        <a href="https://docs.lido.fi/contracts/staking-router/"><strong>Contracts: Staking Router, Lido<br><br>‍</strong></a>
        <a href="https://ethereum.org/en/staking/dvt/#:~:text=Distributed%20validator%20technology%20(DVT)%20is,failure%2C%20and%20increase%20validator%20resiliency"><strong>Distributed validator technology, ethereum.org</strong></a><strong>.<br><br>‍</strong>
        <a href="https://blog.obol.tech/how-dvt-helps-liquid-staking-protocols/"><strong>How DVT Helps: Liquid Staking Protocols, Obol<br><br>‍</strong></a>
        <a href="https://blockworks.co/news/lido-v2-whats-new"><strong>Lido V2 — What’s the difference?, Blockworks<br><br>‍</strong></a>
        <a href="https://www.youtube.com/watch?v=i2K0R9Mfwus"><strong>The Staking Router + DVT: A Seismic Change for LSTs, Blockworks<br><br>‍</strong></a>
        <a href="https://www.adcv.xyz/steth-is-the-decentralized-reserve-currency/"><strong>stETH is the decentralized reserve currency for the sovereign internet, adcv</strong></a>
      </div>
    </div>
    <div class="w-layout-blockcontainer container-6 w-container">
      <a href="https://www.asxn.xyz/" class="button w-button">Subscribe to ASXN&#x27;s Newsletter</a>
      <a href="https://twitter.com/asxn_r" class="button w-button">Follow ASXN on Twitter</a>
    </div>
    <div class="w-layout-blockcontainer container-5 w-container"><img src="images/asxn-crest.jpeg" loading="lazy" sizes="(max-width: 479px) 92vw, 300px" srcset="images/asxn-crest-p-500.jpeg 500w, images/asxn-crest-p-800.jpeg 800w, images/asxn-crest-p-1080.jpeg 1080w, images/asxn-crest-p-1600.jpeg 1600w, images/asxn-crest-p-2000.jpeg 2000w, images/asxn-crest.jpeg 2481w" alt="" class="image crest"></div>
    <div class="w-layout-blockcontainer w-container">
      <div class="text-block-2"><strong>Disclaimer:</strong><em><br><br>The information and services above are not intended to and shall not be used as investment advice.You should consult with financial advisors before acting on any of the information and services. ASXN and ASXN staff are not investment advisors, do not represent or advise clients in any matter and are not bound by the professional responsibilities and duties of a financial advisor.Nothing in the information and service, nor any receipt or use of such information or services, shall be construed or relied on as advertising or soliciting to provide any financial services.</em></div>
    </div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6594359b0f0aa758b21d5c90" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
</body>
</html>